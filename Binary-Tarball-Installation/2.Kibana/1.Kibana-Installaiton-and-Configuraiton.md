# ğŸ“Š Kibana Installation Guide (Tarball-Based)

This document covers the installation and connectivity configuration of Kibana** using a **binary (tarball) setup**.


## Prerequisites

Ensure the following before starting:

* Elasticsearch cluster is **running and reachable**
* You know the `elastic` superuser password
* Network connectivity exists between Kibana host and Elasticsearch nodes

---

## ğŸ–¥ï¸ Hostname Configuration

```bash
hostnamectl set-hostname kibana.apsis.localnet
exec bash
hostname
```

---

## ğŸŒ Host Resolution (`/etc/hosts`)

```bash
cat <<EOF | tee -a /etc/hosts
192.168.20.128 es1 es1.apsis.localnet
192.168.20.129 es2 es2.apsis.localnet
192.168.20.130 es3 es3.apsis.localnet
192.168.20.131 kibana kibana.apsis.localnet
EOF
```

---

## ğŸ“‚ File Descriptor & Process Limits

```bash
cat <<EOF | tee /etc/security/limits.d/kibana.conf
kibana soft nofile 65535
kibana hard nofile 65535
EOF
```

---

## ğŸ‘¤ Create Kibana System User

```bash
useradd --system --no-create-home --shell /usr/sbin/nologin kibana
```

---

## ğŸ“¦ Download and Extract Tarball

```bash
VERSION=9.2.3
cd ~/
wget https://artifacts.elastic.co/downloads/kibana/kibana-$VERSION-linux-x86_64.tar.gz
wget https://artifacts.elastic.co/downloads/kibana/kibana-$VERSION-linux-x86_64.tar.gz.sha512
shasum -a 512 -c kibana-$VERSION-linux-x86_64.tar.gz.sha512
tar -xzf kibana-$VERSION-linux-x86_64.tar.gz
```

---

## ğŸ“‚ Create Directories
```bash
mkdir /es && cd /es
mv ~/kibana-$VERSION_NUMBER /es/
mkdir /es/kibana-$VERSION_NUMBER/logs
ln -s kibana-$VERSION-linux-x86_64 kibana
chown -R kibana:kibana /es
```

---

## Reset `kibana_system` User Password

Run this command on **any Elasticsearch node**:

```bash
/es/elasticsearch/bin/elasticsearch-service-tokens create elastic/kibana kibana-token
```
Exapected Output:   
```txt
SERVICE_TOKEN elastic/kibana/kibana-token = AAEAAWVsYXN0aWMva2liYW5hL2tpYmFuYS10b2tlbjphSVh0T185Z1JDYXVEY0lPZHdydk1B
```

Save the generated token securely.

--- 

ğŸ” Token Rotation
List existing tokens  
```bash
/es/elasticsearch/bin/elasticsearch-service-tokens list
```
Delete token
```bash
/es/elasticsearch/bin/elasticsearch-service-tokens delete elastic/kibana kibana-token
```

---

## Kibana Configuration

Edit the Kibana configuration file:

```bash
/es/kibana/config/kibana.yml
```

Minimal required configuration:

```yaml
# =================== System: Kibana Server ===================
server.port: 5601
server.host: "192.168.20.131"

#server.basePath: ""
#server.rewriteBasePath: false
server.publicBaseUrl: "https://kibana.apsis.localnet"
#server.maxPayload: 1048576
server.name: "Kibana"

# =================== System: Kibana Server (Optional) ===================
server.ssl.enabled: true
server.ssl.certificate: certs/kibana.crt
server.ssl.key: certs/kibana.key

# =================== System: Elasticsearch ===================
elasticsearch.hosts: ["https://es1:9200", "https://es2:9200", "https://es3:9200"]
#elasticsearch.username: "kibana"
#elasticsearch.password: "H4PYrdDPLo18HttdJ1z9"

# Kibana can also authenticate to Elasticsearch via "service account tokens".
# Service account tokens are Bearer style tokens that replace the traditional username/password based configuration.
# Use this token instead of a username/password.
elasticsearch.serviceAccountToken: "AAEAAWVsYXN0aWMva2liYW5hL2tpYmFuYS10b2tlbjphSVh0T185Z1JDYXVEY0lPZHdydk1B"

#elasticsearch.pingTimeout: 1500
#elasticsearch.requestTimeout: 30000
#elasticsearch.maxSockets: 1024
#elasticsearch.compression: false

#elasticsearch.requestHeadersWhitelist: [ authorization ]
#elasticsearch.customHeaders: {}
#elasticsearch.shardTimeout: 30000

# =================== System: Elasticsearch (Optional) ===================
#elasticsearch.ssl.certificate: /path/to/your/client.crt
#elasticsearch.ssl.key: /path/to/your/client.key
elasticsearch.ssl.certificateAuthorities: [ "certs/ca/ca.crt" ]
elasticsearch.ssl.verificationMode: full

# =================== System: Logging ===================
# Set the value of this setting to off to suppress all logging output, or to debug to log everything. Defaults to 'info'
#logging.root.level: debug

# Enables you to specify a file where Kibana stores log output.
logging:
  appenders:
    file:
      type: file
      fileName: /es/kibana/logs/kibana.log
      layout:
        type: json
  root:
    appenders:
      - default
      - file
#  policy:
#    type: size-limit
#    size: 256mb
#  strategy:
#    type: numeric
#    max: 10
#  layout:
#    type: json

# Logs queries sent to Elasticsearch.
#logging.loggers:
#  - name: elasticsearch.query
#    level: debug

# Logs http responses.
#logging.loggers:
#  - name: http.server.response
#    level: debug

# Logs system usage information.
#logging.loggers:
#  - name: metrics.ops
#    level: debug

# Enables debug logging on the browser (dev console)
#logging.browser.root:
#  level: debug

# =================== System: Other ===================
#path.data: data
pid.file: /es/kibana/kibana.pid
#ops.interval: 5000
#i18n.locale: "en"

# =================== Frequently used (Optional)===================
# Kibana internal encryption keys (REQUIRED)
xpack.security.encryptionKey: "lDfeb9eqBh1/40ao+/3mbMrTS2rBArf5zhxXDvQSrGJuQNCl91fgcFNZatUvMlPA"
xpack.encryptedSavedObjects.encryptionKey: "EDts25VGQJbcYc+5EsMz7OlfJ0A3Qu0v4o1Tjm4zF+U5jAzmSOSXQFClawSWNIa1"
xpack.reporting.encryptionKey: "NyuH/OBP7ABpyLL3dfhp29SEKBhTeE9yam8E6O0Rt4ljmxZoEfc5w4J4mQ49g7Iz"
# =================== Saved Objects: Migrations ===================
#migrations.batchSize: 1000
#migrations.maxBatchSizeBytes: 100mb
#migrations.retryAttempts: 15

# =================== Search Autocomplete ===================
#unifiedSearch.autocomplete.valueSuggestions.timeout: 1000
#unifiedSearch.autocomplete.valueSuggestions.terminateAfter: 100000
```

---

## 6ï¸âƒ£ Systemd Service for Kibana

Create the systemd service file:

```bash
cat > /etc/systemd/system/kibana.service << 'EOF'
[Unit]
Description=Kibana
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=kibana
Group=kibana
ExecStart=/opt/kibana/bin/kibana
Restart=always
RestartSec=10
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target
EOF
```

Enable and start Kibana:

```bash
systemctl daemon-reexec
systemctl enable kibana
systemctl start kibana
```

---

## 7ï¸âƒ£ Verify Kibana

### Service Status

```bash
systemctl status kibana
```

### Logs

```bash
journalctl -u kibana -f
```

## ğŸ”¥ Firewall Configuration
### Ubuntu (UFW)
```bash
ufw allow 22
ufw allow 5601
ufw reload
```

### RHEL (firewalld)
```bash
firewall-cmd --permanent --add-port=5601/tcp
firewall-cmd --reload
```

### Access Kibana UI

Open in browser:

```text
http://<kibana-host>:5601
```

Login using:

* **Username:** elastic
* **Password:** (elastic user password)

---

## ğŸ Installation Complete

At this point:

* âœ… Kibana is installed
* âœ… Kibana is connected to Elasticsearch
* âœ… UI is accessible

ğŸ”œ **Next steps (not included here):**

* TLS certificate generation
* HTTPS enablement
* Security hardening

---

*This document intentionally covers installation only.*
