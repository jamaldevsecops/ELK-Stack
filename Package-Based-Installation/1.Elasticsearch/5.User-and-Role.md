# ğŸ” Elasticsearch User & Role Hardening Guide

This guide explains how to **secure Elasticsearch access** using **least-privilege roles and users** for production environments.

---

## ğŸ¯ Objectives

- Remove overuse of `elastic` superuser
- Apply **principle of least privilege**
- Separate human vs application access
- Improve auditability & security posture

---

## âš ï¸ Important Rule

ğŸš« **Do NOT use the `elastic` user for applications**  
âœ” Use it **only for administration & emergencies**

---

## ğŸ‘¤ 1. Create Admin Role (Non-Superuser)

```bash
curl -u elastic -X PUT https://es1:9200/_security/role/es_admin -H "Content-Type: application/json" -d '
{
  "cluster": ["monitor", "manage"],
  "indices": [
    {
      "names": ["*"],
      "privileges": ["all"]
    }
  ]
}'
```

âœ” Full management without superuser power

---

## ğŸ‘¤ 2. Create Read-Only Role

```bash
curl -u elastic -X PUT https://es1:9200/_security/role/es_readonly -H "Content-Type: application/json" -d '
{
  "cluster": ["monitor"],
  "indices": [
    {
      "names": ["*"],
      "privileges": ["read", "view_index_metadata"]
    }
  ]
}'
```

---

## ğŸ‘¤ 3. Create Application Writer Role

```bash
curl -u elastic -X PUT https://es1:9200/_security/role/es_writer -H "Content-Type: application/json" -d '
{
  "cluster": ["monitor"],
  "indices": [
    {
      "names": ["app-*"],
      "privileges": ["create_index", "write"]
    }
  ]
}'
```

---

## ğŸ‘¥ 4. Create Users

### ğŸ”¹ Admin User
```bash
curl -u elastic -X POST https://es1:9200/_security/user/admin_user -H "Content-Type: application/json" -d '
{
  "password": "STRONG_PASSWORD",
  "roles": ["es_admin"],
  "full_name": "Elasticsearch Admin"
}'
```

### ğŸ”¹ Application User
```bash
curl -u elastic -X POST https://es1:9200/_security/user/app_user -H "Content-Type: application/json" -d '
{
  "password": "STRONG_PASSWORD",
  "roles": ["es_writer"]
}'
```

### ğŸ”¹ Read-only User
```bash
curl -u elastic -X POST https://es1:9200/_security/user/viewer -H "Content-Type: application/json" -d '
{
  "password": "STRONG_PASSWORD",
  "roles": ["es_readonly"]
}'
```

---

## ğŸ” 5. Verify Users

```bash
curl -u elastic https://es1:9200/_security/user?pretty
```

---

## ğŸ§¾ 6. Audit Best Practices

- Enable audit logs (already default in your setup)
- Rotate passwords every 90 days
- Use different users per application
- Prefer API keys for automation

---

## ğŸŸ¢ Hardening Checklist

| Item | Status |
|----|----|
| Superuser usage minimized | âœ… |
| Least privilege roles | âœ… |
| Separate app users | âœ… |
| Auditing enabled | âœ… |

---

