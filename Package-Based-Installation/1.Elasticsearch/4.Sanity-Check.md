# ðŸ§ª Elasticsearch Cluster Sanity Check Guide

This document provides **post-installation sanity checks** to verify that your **Elasticsearch cluster, TLS, security, and node roles** are correctly configured.

---

## âœ… 1. Verify Cluster Health

ðŸ” **Command**
```bash
curl -k -u elastic https://es1:9200/_cluster/health?pretty
```

âœ… **Expected Output**
```json
{
  "cluster_name": "nagad-escluster",
  "status": "green",
  "number_of_nodes": 3,
  "number_of_data_nodes": 2,
  "active_shards_percent_as_number": 100.0
}
```

ðŸŸ¢ **What this confirms**
- Cluster formed successfully
- All primary & replica shards allocated
- No split-brain or discovery issues

---

## ðŸ§© 2. Verify Node Membership & Roles

ðŸ” **Command**
```bash
curl -k -u elastic https://es1:9200/_cat/nodes?v
```

âœ… **Expected Output**
```
ip              node.role  master  name
192.168.20.128  m          -       es1
192.168.20.129  dim        *       es2
192.168.20.130  dim        -       es3
```

ðŸŸ¢ **Role decoding**
- `m`  â†’ master-only node
- `d`  â†’ data node
- `i`  â†’ ingest node
- `*`  â†’ current elected master

âœ” Confirms correct **role separation**

---

## 1ï¸âƒ£ Remove -k (recommended)
Trust your CA on clients:
```bash
cp /etc/elasticsearch/certs/ca/ca.crt /usr/local/share/ca-certificates/nagad-es-ca.crt
update-ca-certificates
```

## ðŸ” 3. Verify HTTPS & TLS Trust

### 3.1 System CA Trust Installed

```bash
ls -l /etc/ssl/certs | grep nagad-es-ca
```

Expected:
```
nagad-es-ca.pem -> /usr/local/share/ca-certificates/nagad-es-ca.crt
```

âœ” Confirms CA is trusted system-wide

---

### 3.2 Curl without `-k` (STRICT TLS)

```bash
curl -u elastic https://es1:9200
```

âœ” No TLS warnings  
âœ” No `-k` flag required

---

## ðŸ”‘ 4. Per-node authentication checks

```bash
curl -k -u elastic https://es1:9200/_security/_authenticate?pretty
curl -k -u elastic https://es2:9200/_security/_authenticate?pretty
curl -k -u elastic https://es3:9200/_security/_authenticate?pretty
```

Expected:
```json
{
  "username": "elastic",
  "roles": ["superuser"]
}
```

âœ” Security enabled  
âœ” Built-in users working

---

## ðŸ§  5. Verify Cluster Discovery

```bash
curl -u elastic https://es1:9200/_cluster/state/master_node,nodes?pretty
```

âœ” All nodes visible  
âœ” Single master elected

---

## ðŸ“Š 6. Resource & JVM Check

```bash
curl -u elastic https://es1:9200/_nodes/stats/jvm?pretty
```

âœ” Heap usage < 75%  
âœ” No GC pressure

---

## ðŸ§¯ 7. Check for Warnings or Errors

```bash
curl -u elastic https://es1:9200/_cluster/health?level=shards&pretty
```

Expected:
```
"unassigned_shards": 0
```

âœ” No allocation issues

---

## ðŸŸ¢ FINAL VERDICT

| Check | Status |
|-----|------|
| Cluster health | âœ… GREEN |
| TLS (HTTP + transport) | âœ… |
| Authentication | âœ… |
| Node roles | âœ… |
| Master election | âœ… |
| Shard allocation | âœ… |

ðŸŽ‰ **Your Elasticsearch cluster is production-ready**

---
Prev: [Cluster Configuration](https://github.com/jamaldevsecops/ELK-Stack/blob/master/Package-Based-Installation/3.Cluster-Configuration.md)
